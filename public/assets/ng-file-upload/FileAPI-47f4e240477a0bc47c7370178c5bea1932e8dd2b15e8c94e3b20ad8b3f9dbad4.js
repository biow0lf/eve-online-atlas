/*! FileAPI 2.0.7 - BSD | git://github.com/mailru/FileAPI.git
 * FileAPI â€” a set of  javascript tools for working with files. Multiupload, drag'n'drop and chunked file upload. Images: crop, resize and auto orientation by EXIF.
 */
/*
 * JavaScript Canvas to Blob 2.0.5
 * https://github.com/blueimp/JavaScript-Canvas-to-Blob
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Based on stackoverflow user Stoive's code snippet:
 * http://stackoverflow.com/q/4998908
 */
!function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,a,s,u,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),a=new Uint8Array(o),s=0;s<t.length;s+=1)a[s]=t.charCodeAt(s);return u=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([r?a:o],{type:u}):(c=new i,c.append(o),c.getBlob(u))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){e(r&&t.toDataURL&&o?o(this.toDataURL(n,r)):this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e,t){"use strict";function n(e,t,n,r,i){var o={type:n.type||n,target:e,result:r};H(o,i),t(o)}function r(e){return b&&!!b.prototype["readAs"+e]}function i(e,i,o,a){if(Y.isBlob(e)&&r(o)){var s=new b;V(s,F,function c(t){var r=t.type;"progress"==r?n(e,i,t,t.target.result,{loaded:t.loaded,total:t.total}):"loadend"==r?(W(s,F,c),s=null):n(e,i,t,t.target.result)});try{a?s["readAs"+o](e,a):s["readAs"+o](e)}catch(u){n(e,i,"error",t,{error:u.toString()})}}else n(e,i,"error",t,{error:"FileReader_not_support_"+o})}function o(e,t){if(!e.type&&e.size%4096===0&&e.size<=102400)if(b)try{var n=new b;G(n,F,function(e){var r="error"!=e.type;t(r),r&&n.abort()}),n.readAsDataURL(e)}catch(r){t(!1)}else t(null);else t(!0)}function a(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function s(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n])},function(e){t("FileError.code: "+e.code)});else if(e.isDirectory){var n=e.createReader(),r=[];n.readEntries(function(e){Y.afor(e,function(e,n){s(n,function(n,i){n?Y.log(n):r=r.concat(i),e?e():t(!1,r)})})},function(e){t("directory_reader: "+e)})}else s(a(e),t);else t("invalid entry")}function u(e){var t={};return B(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=H({},e)),t[n]=e}),t}function c(e){return j.test(e&&e.tagName)}function l(e){return(e.originalEvent||e||"").dataTransfer||{}}function f(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var p=1,d=function(){},h=e.document,g=h.doctype||{},m=e.navigator.userAgent,v=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,$=e.Blob,y=e.File,b=e.FileReader,w=e.FormData,x=e.XMLHttpRequest,A=e.jQuery,_=!(!(y&&b&&(e.Uint8Array||w||x.prototype.sendAsBinary))||/safari\//i.test(m)&&!/chrome\//i.test(m)&&/windows/i.test(m)),S=_&&"withCredentials"in new x,E=_&&!!$&&!!($.prototype.webkitSlice||$.prototype.mozSlice||$.prototype.slice),k=e.dataURLtoBlob,C=/img/i,T=/canvas/i,I=/img|canvas/i,j=/input/i,O=/^data:[^,]+,/,R={}.toString,P=e.Math,M=function(t){return t=new e.Number(P.pow(1024,t)),t.from=function(e){return P.round(e*this)},t},D={},N=[],F="abort progress error load loadend",U="status statusText readyState response responseXML responseText responseBody".split(" "),L="currentTarget",q="preventDefault",z=function(e){return e&&"length"in e},B=function(e,t,n){if(e)if(z(e))for(var r=0,i=e.length;i>r;r++)r in e&&t.call(n,e[r],r,e);else for(var o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)},H=function(e){for(var t=arguments,n=1,r=function(t,n){e[n]=t};n<t.length;n++)B(t[n],r);return e},V=function(e,t,n){if(e){var r=Y.uid(e);D[r]||(D[r]={});var i=b&&e&&e instanceof b;B(t.split(/\s+/),function(t){A&&!i?A.event.add(e,t,n):(D[r][t]||(D[r][t]=[]),D[r][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},W=function(e,t,n){if(e){var r=Y.uid(e),i=D[r]||{},o=b&&e&&e instanceof b;B(t.split(/\s+/),function(t){if(A&&!o)A.event.remove(e,t,n);else{for(var r=i[t]||[],a=r.length;a--;)if(r[a]===n){r.splice(a,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},G=function(e,t,n){V(e,t,function r(i){W(e,t,r),n(i)})},X=function(t){return t.target||(t.target=e.event&&e.event.srcElement||h),3===t.target.nodeType&&(t.target=t.target.parentNode),t},K=function(e){var t=h.createElement("input");return t.setAttribute("type","file"),e in t},Y={version:"2.0.7",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:M(1),MB:M(2),GB:M(3),TB:M(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[Y.expando]=e[Y.expando]||Y.uid():(++p,Y.expando+p)},log:function(){Y.debug&&Y._supportConsoleLog&&(Y._supportConsoleLogApply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=h.createElement("img");return t&&Y.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(x)t=new x;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:z,support:{dnd:S&&"ondrop"in h.createElement("div"),cors:S,html5:_,chunked:E,dataURI:!0,accept:K("accept"),multiple:K("multiple")},event:{on:V,off:W,one:G,fix:X},throttle:function(t,n){var r,i;return function(){i=arguments,r||(t.apply(e,i),r=setTimeout(function(){r=0,t.apply(e,i)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,r=[],i={resolve:function(t,o){for(i.resolve=d,n=t||!1,e=o;o=r.shift();)o(n,e)},then:function(i){n!==t?i(n,e):r.push(i)}};return i},queue:function(e){var t=0,n=0,r=!1,i=!1,o={inc:function(){n++},next:function(){t++,setTimeout(o.check,0)},check:function(){t>=n&&!r&&o.end()},isFail:function(){return r},fail:function(){!r&&e(r=!0)},end:function(){i||(i=!0,e())}};return o},each:B,afor:function(e,t){var n=0,r=e.length;z(e)&&r--?!function i(){t(r!=n&&i,e[n],n++)}():t(!1)},extend:H,isFile:function(e){return"[object File]"===R.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===R.call(e)},isCanvas:function(e){return e&&T.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){Y.isCanvas(e)?n(e,t,"load",Y.toDataURL(e)):i(e,t,"DataURL")},readAsBinaryString:function(e,t){r("BinaryString")?i(e,t,"BinaryString"):i(e,function(e){if("load"==e.type)try{e.result=Y.toBinaryString(e.result)}catch(n){e.type="error",e.message=n.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){i(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),i(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(Y.toDataURL(t).replace(O,""))},readAsImage:function(e,r,i){if(Y.isFile(e))if(v){var o=v.createObjectURL(e);o===t?n(e,r,"error"):Y.readAsImage(o,r,i)}else Y.readAsDataURL(e,function(t){"load"==t.type?Y.readAsImage(t.result,r,i):(i||"error"==t.type)&&n(e,r,t,null,{loaded:t.loaded,total:t.total})});else if(Y.isCanvas(e))n(e,r,"load",e);else if(C.test(e.nodeName))if(e.complete)n(e,r,"load",e);else{var a="error abort load";G(e,a,function u(t){"load"==t.type&&v&&v.revokeObjectURL(e.src),W(e,a,u),n(e,r,t,e)})}else if(e.iframe)n(e,r,{type:"error"});else{var s=Y.newImage(e.dataURL||e);Y.readAsImage(s,r,i)}},checkFileObj:function(e){var t={},n=Y.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),B(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||Y.ext2mime[t.type])&&(t.type=Y.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n=[],r=l(e),i=z(r.items)&&r.items[0]&&a(r.items[0]),u=Y.queue(function(){t(n)});B((i?r.items:r.files)||[],function(e){u.inc();try{i?s(e,function(e,t){e?Y.log("[err] getDropFiles:",e):n.push.apply(n,t),u.next()}):o(e,function(t){t&&n.push(e),u.next()})}catch(t){u.next(),Y.log("[err] getDropFiles: ",t)}}),u.check()},getFiles:function(e,t,n){var r=[];return n?(Y.filterFiles(Y.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){r=r.concat(Y.getFiles(this))}),e=r,r=[]),"string"==typeof t&&(t=Y.getFilesFilter(t)),e.originalEvent?e=X(e.originalEvent):e.srcElement&&(e=X(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(r=e.files,_||(r[0].blob=e,r[0].iframe=!0)):!_&&c(e)?Y.trim(e.value)&&(r=[Y.checkFileObj(e.value)],r[0].blob=e,r[0].iframe=!0):z(e)&&(r=e),Y.filter(r,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},r=N.concat();Y.isFile(e)?!function i(){var o=r.shift();o?o.test(e.type)?o(e,function(e,r){e?t(e):(H(n,r),i())}):i():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},N.push(t)},filter:function(e,t){for(var n,r=[],i=0,o=e.length;o>i;i++)i in e&&(n=e[i],t.call(n,n,i,e)&&r.push(n));return r},filterFiles:function(e,t,n){if(e.length){var r,i=e.concat(),o=[],a=[];!function s(){i.length?(r=i.shift(),Y.getInfo(r,function(e,n){(t(r,e?!1:n)?o:a).push(r),s()})):n(o,a)}()}else n([],e)},upload:function(e){e=H({jsonp:"callback",prepare:Y.F,beforeupload:Y.F,upload:Y.F,fileupload:Y.F,fileprogress:Y.F,filecomplete:Y.F,progress:Y.F,complete:Y.F,pause:Y.F,imageOriginal:!0,chunkSize:Y.chunkSize,chunkUploadRetry:Y.chunkUploadRetry,uploadRetry:Y.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new Y.XHR(e),r=this._getFilesDataArray(e.files),i=this,o=0,a=0,s=!1;return B(r,function(e){o+=e.size}),n.files=[],B(r,function(e){n.files.push(e.file)}),n.total=o,n.loaded=0,n.filesLeft=r.length,e.beforeupload(n,e),t=function(){var c=r.shift(),l=c&&c.file,f=!1,p=u(e);if(n.filesLeft=r.length,l&&l.name===Y.expando&&(l=null,Y.log("[warn] FileAPI.upload() \u2014 called without files")),("abort"!=n.statusText||n.current)&&c){if(s=!1,n.currentFile=l,l&&e.prepare(l,p)===!1)return void t.call(i);p.file=l,i._getFormData(p,c,function(s){a||e.upload(n,e);var u=new Y.XHR(H({},p,{upload:l?function(){e.fileupload(l,u,p)}:d,progress:l?function(t){f||(f=t.loaded===t.total,e.fileprogress({type:"progress",total:c.total=t.total,loaded:c.loaded=t.loaded},l,u,p),e.progress({type:"progress",total:o,loaded:n.loaded=a+c.size*(t.loaded/t.total)|0},l,u,p))}:d,complete:function(r){B(U,function(e){n[e]=u[e]}),l&&(c.total=c.total||c.size,c.loaded=c.total,r||(this.progress(c),f=!0,a+=c.size,n.loaded=a),e.filecomplete(r,u,l,p)),setTimeout(function(){t.call(i)},0)}}));n.abort=function(e){e||(r.length=0),this.current=e,u.abort()},u.send(s)})}else{var h=200==n.status||201==n.status||204==n.status;e.complete(h?!1:n.statusText||"error",n,e),s=!0}},setTimeout(t,0),n.append=function(e,a){e=Y._getFilesDataArray([].concat(e)),B(e,function(e){o+=e.size,n.files.push(e.file),a?r.unshift(e):r.push(e)}),n.statusText="",s&&t.call(i)},n.remove=function(e){for(var t,n=r.length;n--;)r[n].file==e&&(t=r.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(c(e)){var r=Y.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?r:r[0]}else z(e)&&c(e[0])?B(e,function(e){n[e.name||"file"]=Y.getFiles(e)}):n=e;return B(n,function i(e,n){z(e)?B(e,function(e){i(e,n)}):e&&(e.name||e.image)&&t.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),t.length||t.push({file:{name:Y.expando}}),t},_getFormData:function(e,t,n){var r=t.file,i=t.name,o=r.name,a=r.type,s=Y.support.transform&&e.imageTransform,u=new Y.Form,c=Y.queue(function(){n(u)}),l=s&&f(s),p=Y.postNameConcat;B(e.data,function d(e,t){"object"==typeof e?B(e,function(e,n){d(e,p(t,n))}):u.append(t,e)}),function h(t){t.image?(c.inc(),t.toData(function(e,t){o=o||(new Date).getTime()+".png",h(t),c.next()})):Y.Image&&s&&(/^image/.test(t.type)||I.test(t.nodeName))?(c.inc(),l&&(s=[s]),Y.Image.transform(t,s,e.imageAutoOrientation,function(n,r){if(l&&!n)k||Y.flashEngine||(u.multipart=!0),u.append(i,r[0],o,s[0].type||a);else{var f=0;n||B(r,function(e,t){k||Y.flashEngine||(u.multipart=!0),s[t].postName||(f=1),u.append(s[t].postName||p(i,t),e,o,s[t].type||a)}),(n||e.imageOriginal)&&u.append(p(i,f?"original":null),t,o,a)}c.next()})):o!==Y.expando&&u.append(i,t,o)}(r),c.check()},reset:function(e,t){var n,r;return A?(r=A(e).clone(!0).insertBefore(e).val("")[0],t||A(e).remove()):(n=e.parentNode,r=n.insertBefore(e.cloneNode(!0),e),r.value="",t||n.removeChild(e),B(D[Y.uid(e)],function(t,n){B(t,function(t){W(e,n,t),V(r,n,t)})})),r},load:function(e,t){var n=Y.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),V(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var r={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};r.dataURL="data:"+r.type+";base64,"+Y.encode64(n.responseBody||n.responseText),t({type:"load",result:r},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",r=0;for("string"!=typeof e&&(e=String(e));r<e.length;){var i,o,a=255&e.charCodeAt(r++),s=255&e.charCodeAt(r++),u=255&e.charCodeAt(r++),c=a>>2,l=(3&a)<<4|s>>4;isNaN(s)?i=o=64:(i=(15&s)<<2|u>>6,o=isNaN(u)?64:63&u),n+=t.charAt(c)+t.charAt(l)+t.charAt(i)+t.charAt(o)}return n}};Y.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=Y.defer();Y.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t.src=Y.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),Y.event.dnd=function(e,t,n){var r,i;n||(n=t,t=Y.F),b?(V(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=l(e).types,o=n&&n.length,a=!1;o--;)if(~n[o].indexOf("File")){e[q](),i!==e.type&&(i=e.type,"dragleave"!=i&&t.call(e[L],!0,e),a=!0);break}a&&(clearTimeout(r),r=setTimeout(function(){t.call(e[L],"dragleave"!=i,e)},50))}),V(e,"drop",n.ff=n.ff||function(e){e[q](),i=0,t.call(e[L],!1,e),Y.getDropFiles(e,function(t){n.call(e[L],t,e)})})):Y.log("Drag'n'Drop -- not supported")},Y.event.dnd.off=function(e,t,n){W(e,"dragenter dragleave dragover",t.ff),W(e,"drop",n.ff)},A&&!A.fn.dnd&&(A.fn.dnd=function(e,t){return this.each(function(){Y.event.dnd(this,e,t)})},A.fn.offdnd=function(e,t){return this.each(function(){Y.event.dnd.off(this,e,t)})}),e.FileAPI=H(Y,e.FileAPI),Y.log("FileAPI: "+Y.version),Y.log("protocol: "+e.location.protocol),Y.log("doctype: ["+g.name+"] "+g.publicId+" "+g.systemId),B(h.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&Y.log("meta.http-equiv: "+e.getAttribute("content"))});try{Y._supportConsoleLog=!!console.log,Y._supportConsoleLogApply=!!console.log.apply}catch(J){}Y.flashUrl||(Y.flashUrl=Y.staticPath+"FileAPI.flash.swf"),Y.flashImageUrl||(Y.flashImageUrl=Y.staticPath+"FileAPI.flash.image.swf"),Y.flashWebcamUrl||(Y.flashWebcamUrl=Y.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){"use strict";function r(t){if(t instanceof r){var n=new r(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof r?(this.file=t,this.size=t.size||100,void(this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new r(t)}var i=Math.min,o=Math.round,a=function(){return t.createElement("canvas")},s=!1,u={8:270,3:180,6:90,7:270,4:180,5:90};try{s=a().toDataURL("image/png").indexOf("data:image/png")>-1}catch(c){}r.prototype={image:!0,constructor:r,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,r,i){return r===n&&(r=e,i=t,e=t=0),this.set({sx:e,sy:t,sw:r,sh:i||r})},resize:function(e,t,n){return/min|max/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new r(this)},_load:function(t,n){var r=this;/img|video/i.test(t.nodeName)?n.call(r,null,t):e.readAsImage(t,function(e){n.call(r,"load"!=e.type,e.result)})},_apply:function(t,n){var o,s=a(),u=this.getMatrix(t),c=s.getContext("2d"),l=t.videoWidth||t.width,f=t.videoHeight||t.height,p=u.deg,d=u.dw,h=u.dh,g=l,m=f,v=u.filter,$=t,y=u.overlay,b=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),w=e.renderImageToCanvas;for(p-=360*Math.floor(p/360),t._type=this.file.type;u.multipass&&i(g/d,m/h)>2;)g=g/2+.5|0,m=m/2+.5|0,o=a(),o.width=g,o.height=m,$!==t?(w(o,$,0,0,$.width,$.height,0,0,g,m),$=o):($=o,w($,t,u.sx,u.sy,u.sw,u.sh,0,0,g,m),u.sx=u.sy=u.sw=u.sh=0);s.width=p%180?h:d,s.height=p%180?d:h,s.type=u.type,s.quality=u.quality,c.rotate(p*Math.PI/180),w(c.canvas,$,u.sx,u.sy,u.sw||$.width,u.sh||$.height,180==p||270==p?-d:0,90==p||180==p?-h:0,d,h),d=s.width,h=s.height,y&&e.each([].concat(y),function(t){b.inc();var n=new window.Image,r=function(){var i=0|t.x,o=0|t.y,a=t.w||n.width,s=t.h||n.height,u=t.rel;i=1==u||4==u||7==u?(d-a+i)/2:2==u||5==u||8==u?d-(a+i):i,o=3==u||4==u||5==u?(h-s+o)/2:u>=6?h-(s+o):o,e.event.off(n,"error load abort",r);try{c.globalAlpha=t.opacity||1,c.drawImage(n,i,o,a,s)}catch(l){}b.next()};e.event.on(n,"error load abort",r),n.src=t.src,n.complete&&r()}),v&&(b.inc(),r.applyFilter(s,v,b.next)),b.check()},getMatrix:function(t){var n=e.extend({},this.matrix),r=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,a=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||r,u=n.dh=n.dh||a,c=r/a,l=s/u,f=n.resize;if("preview"==f){if(s!=r||u!=a){var p,d;l>=c?(p=r,d=p/l):(d=a,p=d*l),(p!=r||d!=a)&&(n.sx=~~((r-p)/2),n.sy=~~((a-d)/2),r=p,a=d)}}else f&&(r>s||a>u?"min"==f?(s=o(l>c?i(r,s):u*c),u=o(l>c?s/c:i(a,u))):(s=o(c>=l?i(r,s):u*c),u=o(c>=l?s/c:i(a,u))):(s=r,u=a));return n.sw=r,n.sh=a,n.dw=s,n.dh=u,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,r){if(n)t(n);else try{this._apply(r,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,r=n.matrix;"auto"==r.deg?e.getInfo(n.file,function(e,i){r.deg=u[i&&i.exif&&i.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},r.exifOrientation=u,r.transform=function(t,i,o,a){function s(s,u){var c={},l=e.queue(function(e){a(e,c)});s?l.fail():e.each(i,function(e,i){if(!l.isFail()){var a=new r(u.nodeType?u:t),s="function"==typeof e;if(s?e(u,a):e.width?a[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(u.width>e.maxWidth||u.height>e.maxHeight)&&a.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var f=e.crop;a.crop(0|f.x,0|f.y,f.w||f.width,f.h||f.height)}e.rotate===n&&o&&(e.rotate="auto"),a.set({type:a.matrix.type||e.type||t.type||"image/png"}),s||a.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),l.inc(),a.toData(function(e,t){e?l.fail():(c[i]=t,l.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,i){r[t+"_"+e]=3*n+i,r[e+"_"+t]=3*n+i})}),r.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},r.fromDataURL=function(t,n,r){var i=e.newImage(t);e.extend(i,n),r(i)},r.applyFilter=function(t,n,i){"function"==typeof n?n(t,i):window.Caman&&window.Caman("IMG"==t.tagName?r.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(i)})},e.renderImageToCanvas=function(t,n,r,i,o,a,s,u,c,l){try{return t.getContext("2d").drawImage(n,r,i,o,a,s,u,c,l)}catch(f){throw e.log("renderImageToCanvas failed"),f}},e.support.canvas=e.support.transform=s,e.Image=r}(FileAPI,document),/*
 * JavaScript Load Image iOS scaling fixes 1.0.3
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * iOS image scaling fixes based on
 * https://github.com/stomita/ios-imagefile-megapixel
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";e(FileAPI)}(function(e){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-e.width+1,0),0===n.getImageData(0,0,1,1).data[3]):!1},e.detectVerticalSquash=function(e,t){var n,r,i,o,a,s=e.naturalHeight||e.height,u=document.createElement("canvas"),c=u.getContext("2d");for(t&&(s/=2),u.width=1,u.height=s,c.drawImage(e,0,0),n=c.getImageData(0,0,1,s).data,r=0,i=s,o=s;o>r;)a=n[4*(o-1)+3],0===a?i=o:r=o,o=i+r>>1;return o/s||1},e.renderImageToCanvas=function(n,r,i,o,a,s,u,c,l,f){if("image/jpeg"===r._type){var p,d,h,g,m=n.getContext("2d"),v=document.createElement("canvas"),$=1024,y=v.getContext("2d");if(v.width=$,v.height=$,m.save(),p=e.detectSubsampling(r),p&&(i/=2,o/=2,a/=2,s/=2),d=e.detectVerticalSquash(r,p),p||1!==d){for(o*=d,l=Math.ceil($*l/a),f=Math.ceil($*f/s/d),c=0,g=0;s>g;){for(u=0,h=0;a>h;)y.clearRect(0,0,$,$),y.drawImage(r,i,o,a,s,-h,-g,a,s),m.drawImage(v,0,0,$,$,u,c,l,f),h+=$,u+=l;g+=$,c+=f}return m.restore(),n}}return t(n,r,i,o,a,s,u,c,l,f)}}}),function(e,t){"use strict";function n(t,n,r){var i=t.blob,o=t.file;if(o){if(!i.toDataURL)return void e.readAsBinaryString(i,function(e){"load"==e.type&&n(t,e.result)});var a={"image/jpeg":".jpe?g","image/png":".png"},s=a[t.type]?t.type:"image/png",u=a[s]||".png",c=i.quality||1;o.match(new RegExp(u+"$","i"))||(o+=u.replace("?","")),t.file=o,t.type=s,!r&&i.toBlob?i.toBlob(function(e){n(t,e)},s,c):n(t,e.toBinaryString(i.toDataURL(s,c)))}else n(t,i)}var r=t.document,i=t.FormData,o=function(){this.items=[]},a=t.encodeURIComponent;o.prototype={append:function(e,t,n,r){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(r||t.type)})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&i?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,r,i){var o=e.queue(function(){n(t)});this.each(function(e){r(e,t,o,i)}),o.check()},toHtmlData:function(t){this._to(r.createDocumentFragment(),t,function(t,n){var i,o=t.blob;t.file?(e.reset(o,!0),o.name=t.name,o.disabled=!1,n.appendChild(o)):(i=r.createElement("input"),i.name=t.name,i.type="hidden",i.value=o,n.appendChild(i))})},toPlainData:function(e){this._to({},e,function(e,t,r){e.file&&(t.type=e.file),e.blob.toBlob?(r.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,r.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(a(e.name)+"="+a(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new i,e,function(e,t,r){e.blob&&e.blob.toBlob?(r.inc(),n(e,function(e,n){t.append(e.name,n,e.file),r.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,r,i){r.inc(),n(e,function(e,n){t.push("--_"+i+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+a(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:a(n))+"\r\n")),r.next()},!0)},e.expando)}},e.Form=o}(FileAPI,window),function(e,t){"use strict";var n=function(){},r=e.document,i=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},o={"":1,XML:1,Text:1,Body:1};i.prototype={status:0,statusText:"",constructor:i,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(r,i){var o=this,a=o.options;o.end=o.abort=n,o.status=r,i&&(o.statusText=i),t.log("xhr.end:",r,i),a.complete(200==r||201==r?!1:o.statusText||"unknown",o),o.xhr&&o.xhr.node&&setTimeout(function(){var t=o.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[o.uid]}catch(n){}e[o.uid]=o.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){n.upload(n,t),t._send.call(t,n,e)},n)},_send:function(n,i){var a,s=this,u=s.uid,c=s.uid+"Load",l=n.url;if(t.log("XHR._send:",i),n.cache||(l+=(~l.indexOf("?")?"&":"?")+t.uid()),i.nodeName){var f=n.jsonp;l=l.replace(/([a-z]+)=(\?)/i,"$1="+u),n.upload(n,s);var p=function(e){if(~l.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==u&&d(n.status,n.statusText,n.response)}catch(r){d(0,r.message)}},d=e[u]=function(n,r,i){s.readyState=4,s.responseText=i,s.end(n,r),t.event.off(e,"message",p),e[u]=a=g=e[c]=null};s.xhr.abort=function(){try{g.stop?g.stop():g.contentWindow.stop?g.contentWindow.stop():g.contentWindow.document.execCommand("Stop")}catch(e){}d(0,"abort")},t.event.on(e,"message",p),e[c]=function(){try{var e=g.contentWindow,n=e.document,r=e.result||t.parseJSON(n.body.innerHTML);d(r.status,r.statusText,r.response)}catch(i){t.log("[transport.onload]",i)}},a=r.createElement("div"),a.innerHTML='<form target="'+u+'" action="'+l+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+u+'" src="javascript:false;" onload="'+c+'()"></iframe>'+(f&&n.url.indexOf("=?")<0?'<input value="'+u+'" name="'+f+'" type="hidden"/>':"")+"</form>";var h=a.getElementsByTagName("form")[0],g=a.getElementsByTagName("iframe")[0];h.appendChild(i),t.log(h.parentNode.innerHTML),r.body.appendChild(a),s.xhr.node=a,s.readyState=2,h.submit(),h=null}else{if(l=l.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(a=s.xhr=t.getXHR(),i.params&&(l+=(l.indexOf("?")<0?"?":"&")+i.params.join("&")),a.open("POST",l,!0),t.withCredentials&&(a.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||a.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){a.setRequestHeader(t,e)}),n._chunked){a.upload&&a.upload.addEventListener("progress",t.throttle(function(e){i.retry||n.progress({type:e.type,total:i.size,loaded:i.start+e.loaded,totalSize:i.size},s,n)},100),!1),a.onreadystatechange=function(){var e=parseInt(a.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){try{for(var r in o)s["response"+r]=a["response"+r]}catch(u){}if(a.onreadystatechange=null,!a.status||a.status-201>0)if(t.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status||416==a.status)&&++i.retry<=n.chunkUploadRetry){var c=a.status?0:t.chunkNetworkDownRetryTimeout;n.pause(i.file,n),t.log("X-Last-Known-Byte: "+e),e?i.end=e:(i.end=i.start-1,416==a.status&&(i.end=i.end-n.chunkSize)),setTimeout(function(){s._send(n,i)},c)}else s.end(a.status);else i.retry=0,i.end==i.size-1?s.end(a.status):(t.log("X-Last-Known-Byte: "+e),e&&(i.end=e),i.file.FileAPIReadPosition=i.end,setTimeout(function(){s._send(n,i)},0));a=null}},i.start=i.end+1,i.end=Math.max(Math.min(i.start+n.chunkSize,i.size)-1,i.start);var m=i.file,v=(m.slice||m.mozSlice||m.webkitSlice).call(m,i.start,i.end+1);i.size&&!v.size?setTimeout(function(){s.end(-1)}):(a.setRequestHeader("Content-Range","bytes "+i.start+"-"+i.end+"/"+i.size),a.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(i.name)),a.setRequestHeader("Content-Type",i.type||"application/octet-stream"),a.send(v)),m=v=null}else if(a.upload&&a.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),a.onreadystatechange=function(){if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){for(var e in o)s["response"+e]=a["response"+e];if(a.onreadystatechange=null,!a.status||a.status>201)if(t.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var r=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){s._send(n,i)},r)}else s.end(a.status);else s.end(a.status);a=null}},t.isArray(i)){a.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var $=i.join("")+"--_"+t.expando+"--";if(a.sendAsBinary)a.sendAsBinary($);else{var y=Array.prototype.map.call($,function(e){return 255&e.charCodeAt(0)});a.send(new Uint8Array(y).buffer)}}else a.send(i)}}},t.XHR=i}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function r(e){var t,n=o.createElement("canvas"),r=!1;try{t=n.getContext("2d"),t.drawImage(e,0,0,1,1),r=255!=t.getImageData(0,0,1,1).data[4]}catch(i){}return r}var i=e.URL||e.webkitURL,o=e.document,a=e.navigator,s=a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,u=!!s;t.support.media=u;var c=function(e){this.video=e};c.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,o=this,u=o.video,c=function(r){o._active=!r,clearTimeout(n),clearTimeout(t),e&&e(r,o)};s.call(a,{video:!0},function(e){o.stream=e,u.src=i.createObjectURL(e),t=setInterval(function(){r(u)&&c(null)},1e3),n=setTimeout(function(){c("timeout")},5e3),u.play()},c)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(e){}},shot:function(){return new l(this.video)}},c.get=function(e){return new c(e.firstChild)},c.publish=function(r,i,a){"function"==typeof i&&(a=i,i={}),i=t.extend({},{width:"100%",height:"100%",start:!0},i),r.jquery&&(r=r[0]);var s=function(e){if(e)a(e);else{var t=c.get(r);i.start?t.start(a):a(null,t)}};if(r.style.width=n(i.width),r.style.height=n(i.height),t.html5&&u){var l=o.createElement("video");l.style.width=n(i.width),l.style.height=n(i.height),e.jQuery?jQuery(r).empty():r.innerHTML="",r.appendChild(l),s()}else c.fallback(r,i,s)},c.fallback=function(e,t,n){n("not_support_camera")};var l=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,r=t.Image(n);return r.type="image/png",r.width=n.width,r.height=n.height,r.size=n.width*n.height*4,r};c.Shot=l,t.Camera=c}(window,FileAPI),function(e,t,n){"use strict";var r=e.document,i=e.location,o=e.navigator,a=n.each;n.support.flash=function(){var t=o.mimeTypes,r=!1;if(o.plugins&&"object"==typeof o.plugins["Shockwave Flash"])r=o.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{r=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){n.log("Flash -- does not supported.")}return r&&/^file:/i.test(i)&&n.log("[warn] Flash does not work on `file:` protocol."),r}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function s(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function u(e,t){if(e&&e.style){var n,r;for(n in t){r=t[n],"number"==typeof r&&(r+="px");try{e.style[n]=r}catch(i){}}}}function c(e,t){a(t,function(t,n){var r=e[n];e[n]=function(){return this.parent=r,t.apply(this,arguments)}})}function l(e){return e&&!e.flashId}function f(e){var t=e.wid=n.uid();return w._fn[t]=e,"FileAPI.Flash._fn."+t}function p(e){try{w._fn[e.wid]=null,delete w._fn[e.wid]}catch(t){}}function d(e,t){if(!b.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=i.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+i.host+e),b.test(e)||(e=i.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function h(e,t,i){function o(){try{var e=w.get(c);e.setImage(t)}catch(r){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',r)}}var a,c=n.uid(),l=r.createElement("div"),h=10;for(a in e)l.setAttribute(a,e[a]),l[a]=e[a];u(l,e),e.width="100%",e.height="100%",l.innerHTML=s(n.extend({id:c,src:d(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+f(function g(){return p(g),--h>0&&o(),!0})},e)),i(!1,l),l=null}function g(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function m(e){function t(e){var t,n;if(t=n=0,e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}}e.getBoundingClientRect(),r.body,(e&&e.ownerDocument).documentElement;return{top:t(e).top,left:t(e).left,width:e.offsetWidth,height:e.offsetHeight}}var v=n.uid(),$=0,y={},b=/^https?:/i,w={_fn:{},publish:function(e,t,r){r=r||{},e.innerHTML=s({id:t,src:d(n.flashUrl,"r="+n.version),wmode:r.camera?"":"transparent",flashvars:"callback="+(r.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+o.userAgent.match(/\d/gi).join("")+"_"+n.version+(w.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(r.camera?"&useCamera="+d(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},r)},init:function(){var e=r.body&&r.body.firstChild;if(e)do if(1==e.nodeType){n.log("FlashAPI.state: awaiting");var t=r.createElement("div");return t.id="_"+v,u(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:1e6+""}),e.parentNode.insertBefore(t,e),void w.publish(t,v)}while(e=e.nextSibling);10>$&&setTimeout(w.init,50*++$)},ready:function(){n.log("FlashAPI.state: ready"),w.ready=n.F,w.isReady=!0,w.patch(),w.patchCamera&&w.patchCamera(),n.event.on(r,"mouseover",w.mouseover),n.event.on(r,"click",function(e){w.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return r.getElementById("_"+v)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==r.body)},disableMouseover:!1,mouseover:function(e){if(!w.disableMouseover){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type&&!t.disabled){var i=t.getAttribute(v),o=w.getWrapper(t);if(n.multiFlash){if("i"==i||"r"==i)return!1;if("p"!=i){t.setAttribute(v,"i");var a=r.createElement("div");if(!o)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");u(a,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:1e6+"",position:"absolute"}),o.appendChild(a),w.publish(a,n.uid()),t.setAttribute(v,"p")}return!0}if(o){var s=m(o);u(w.getEl(),s),w.curInp=t}}else/object|embed/i.test(t.nodeName)||u(w.getEl(),{top:1,left:1,width:5,height:5})}},onEvent:function(e){var t=e.type;if("ready"==t){try{w.getInput(e.flashId).setAttribute(v,"r")}catch(r){}return w.ready(),setTimeout(function(){w.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in w&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),w[t](e)},1)},mouseDown:function(e){w.disableMouseover=!0},cancel:function(e){w.disableMouseover=!1},mouseenter:function(e){var t=w.getInput(e.flashId);if(t){w.cmd(e,"multiple",null!=t.getAttribute("multiple"));var r=[],i={};a((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&a(n.accept[e].split(" "),function(e){i[e]=1})}),a(i,function(e,t){r.push(t)}),w.cmd(e,"accept",r.length?r.join(",")+","+r.join(",").toUpperCase():"*")}},get:function(t){return r[t]||e[t]||r.embeds[t]},getInput:function(e){if(!n.multiFlash)return w.curInp;try{var t=w.getWrapper(w.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(r){n.log('[err] Can not find "input" by flashId:',e,r)}},select:function(e){try{var i,o=w.getInput(e.flashId),s=n.uid(o),u=e.target.files;a(u,function(e){n.checkFileObj(e)}),y[s]=u,r.createEvent?(i=r.createEvent("Event"),i.files=u,i.initEvent("change",!0,!0),o.dispatchEvent(i)):t?t(o).trigger({type:"change",files:u}):(i=r.createEventObject(),i.files=u,o.fireEvent("onchange",i))}finally{w.disableMouseover=!1}},interval:null,cmd:function(e,t,n,r){w.uploadInProgress&&w.readInProgress?setTimeout(function(){w.cmd(e,t,n,r)},100):this.cmdFn(e,t,n,r)},cmdFn:function(e,t,r,i){try{return n.log("(js -> flash)."+t+":",r),w.get(e.flashId||e).cmd(t,r)}catch(o){n.log("(js -> flash).onError:",o),i||setTimeout(function(){w.cmd(e,t,r,!0)},50)}},patch:function(){n.flashEngine=!0,c(n,{readAsDataURL:function(e,t){l(e)?this.parent.apply(this,arguments):(n.log("FlashAPI.readAsBase64"),w.readInProgress=!0,w.cmd(e,"readAsBase64",{id:e.id,callback:f(function r(i,o){w.readInProgress=!1,p(r),n.log("FlashAPI.readAsBase64:",i),t({type:i?"error":"load",error:i,result:"data:"+e.type+";base64,"+o})})}))},readAsText:function(t,r,i){i?n.log("[warn] FlashAPI.readAsText not supported `encoding` param"):i=r,n.readAsDataURL(t,function(t){if("load"==t.type)try{t.result=e.atob(t.result.split(";base64,")[1])}catch(n){t.type="error",t.error=n.toString()}i(t)})},getFiles:function(e,t,r){if(r)return n.filterFiles(n.getFiles(e),t,r),null;var i=n.isArray(e)?e:y[n.uid(e.target||e.srcElement||e)];return i?(t&&(t=n.getFilesFilter(t),i=n.filter(i,function(e){return t.test(e.name)})),i):this.parent.apply(this,arguments)},getInfo:function(e,t){if(l(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var r=e.__info=n.defer();r.resolve(null,e.info=null)}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&c(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),l(e))this.parent.apply(this,arguments);else{var r=this;n.getInfo(e,function(n){t.call(r,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),l(e))this.parent.apply(this,arguments);else{var r=this.getMatrix(e.info),i=t;w.cmd(e,"imageTransform",{id:e.id,matrix:r,callback:f(function o(a,s){n.log("FlashAPI.Image._apply.callback:",a),p(o),a?i(a):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(r.filter&&(i=function(e,i){e?t(e):n.Image.applyFilter(i,r.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,i)):h({width:r.deg%180?r.dh:r.dw,height:r.deg%180?r.dw:r.dh,scale:r.scaleMode},s,i)})})}},toData:function(e){var t=this.file,r=t.info,i=this.getMatrix(r);n.log("FlashAPI.Image.toData"),l(t)?this.parent.apply(this,arguments):("auto"==i.deg&&(i.deg=n.Image.exifOrientation[r&&r.exif&&r.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:i}))}}),n.Image&&c(n.Image,{fromDataURL:function(e,t,r){!n.support.dataURI||e.length>3e4?h(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){r(t)}):this.parent(e,t,r)}}),c(n.Form.prototype,{toData:function(e){for(var t=this.items,r=t.length;r--;)if(t[r].file&&l(t[r].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),c(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var r,i,o={},s={},u=this;if(a(t,function(e){e.file?(s[e.name]=e=g(e.blob),i=e.id,r=e.flashId):o[e.name]=e.blob}),i||(r=v),!r)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+r+" -> "+i),u.xhr={headers:{},abort:function(){w.uploadInProgress=!1,w.cmd(r,"abort",{id:i})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var c=n.queue(function(){w.uploadInProgress=!0,w.cmd(r,"upload",{url:d(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:o,files:i?s:null,headers:e.headers||{},callback:f(function t(r){var i=r.type,o=r.result;n.log("FlashAPI.upload."+i),"progress"==i?(r.loaded=Math.min(r.loaded,r.total),r.lengthComputable=!0,e.progress(r)):"complete"==i?(w.uploadInProgress=!1,p(t),"string"==typeof o&&(u.responseText=o.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),u.end(r.status||200)):("abort"==i||"error"==i)&&(w.uploadInProgress=!1,u.end(r.status||0,r.message),p(t))})})});a(s,function(e){c.inc(),n.getInfo(e,c.next)}),c.check()}})}};n.Flash=w,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),w.init()})}()}(window,window.jQuery,FileAPI),function(e,t,n){"use strict";var r=n.each,i=[];n.support.flash&&n.media&&!n.support.media&&!function(){function e(e){var t=e.wid=n.uid();return n.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function t(e){try{n.Flash._fn[e.wid]=null,delete n.Flash._fn[e.wid]}catch(t){}}var o=n.Flash;n.extend(n.Flash,{patchCamera:function(){n.Camera.fallback=function(r,i,a){var s=n.uid();n.log("FlashAPI.Camera.publish: "+s),o.publish(r,s,n.extend(i,{camera:!0,onEvent:e(function u(e){"camera"===e.type&&(t(u),e.error?(n.log("FlashAPI.Camera.publish.error: "+e.error),a(e.error)):(n.log("FlashAPI.Camera.publish.success: "+s),a(null)))})}))},r(i,function(e){n.Camera.fallback.apply(n.Camera,e)}),i=[],n.extend(n.Camera.prototype,{_id:function(){return this.video.id},start:function(r){var i=this;o.cmd(this._id(),"camera.on",{callback:e(function a(e){t(a),e.error?(n.log("FlashAPI.camera.on.error: "+e.error),r(e.error,i)):(n.log("FlashAPI.camera.on.success: "+i._id()),i._active=!0,r(null,i))})})},stop:function(){this._active=!1,o.cmd(this._id(),"camera.off")},shot:function(){n.log("FlashAPI.Camera.shot:",this._id());var e=n.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}})}}),n.Camera.fallback=function(){i.push(arguments)}}()}(window,window.jQuery,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI});