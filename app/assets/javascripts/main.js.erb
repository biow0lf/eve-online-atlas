var app = angular.module('CrestApiContest', ['ui.router', 'ngAria', 'ngAnimate', 'ngMaterial', 'ngMessages', 'RecursionHelper', 'templates', 'restmod', 'permission', 'md.data.table', 'ngFileUpload', 'ct.ui.router.extras']);

app.config(['$httpProvider', '$stateProvider', '$locationProvider', '$mdThemingProvider', '$mdIconProvider', '$urlRouterProvider', '$stickyStateProvider', function ($httpProvider, $stateProvider, $locationProvider, $mdThemingProvider, $mdIconProvider, $urlRouterProvider, $stickyStateProvider) {

  $httpProvider.defaults.useXDomain = true;
  delete $httpProvider.defaults.headers.common['X-Requested-With'];

  // $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
  $locationProvider.html5Mode({
    enabled: true
  });

  $mdThemingProvider.theme('default').primaryPalette('blue');

  $mdIconProvider
      .iconSet('action', '<%= asset_path('iconsets/action-icons.svg') %>', 24)
      .iconSet('alert', '<%= asset_path('iconsets/alert-icons.svg') %>', 24)
      .iconSet('av', '<%= asset_path('iconsets/av-icons.svg') %>', 24)
      .iconSet('communication', '<%= asset_path('iconsets/communication-icons.svg') %>', 24)
      .iconSet('content', '<%= asset_path('iconsets/content-icons.svg') %>', 24)
      .iconSet('device', '<%= asset_path('iconsets/device-icons.svg') %>', 24)
      .iconSet('editor', '<%= asset_path('iconsets/editor-icons.svg') %>', 24)
      .iconSet('file', '<%= asset_path('iconsets/file-icons.svg') %>', 24)
      .iconSet('hardware', '<%= asset_path('iconsets/hardware-icons.svg') %>', 24)
      .iconSet('icons', '<%= asset_path('iconsets/icons-icons.svg') %>', 24)
      .iconSet('image', '<%= asset_path('iconsets/image-icons.svg') %>', 24)
      .iconSet('maps', '<%= asset_path('iconsets/maps-icons.svg') %>', 24)
      .iconSet('navigation', '<%= asset_path('iconsets/navigation-icons.svg') %>', 24)
      .iconSet('notification', '<%= asset_path('iconsets/notification-icons.svg') %>', 24)
      .iconSet('social', '<%= asset_path('iconsets/social-icons.svg') %>', 24)
      .iconSet('toggle', '<%= asset_path('iconsets/toggle-icons.svg') %>', 24);

  var root = {
    name: 'root',
    abstract: true,
    views: {
      '': {
        templateUrl: 'application/layout/layout.html'
      },
      'toolbar@root': {
        templateUrl: 'application/layout/toolbar.html'
      },
      'sidenav@root': {
        templateUrl: 'application/layout/sidenav.html'
      }
    }
  };

  var dashboard = {
    name: 'root.dashboard',
    parent: root,
    url: '/',
    templateUrl: 'application/dashboard/layout.html'
  };

  var chat_tracker = {
    name: 'root.chat_tracker',
    parent: root,
    url: '/chat_tracker',
    templateUrl: 'application/chat_tracker/layout.html',
    sticky: true,
    dsr: true
  };

  $stateProvider
      .state(root)
      .state(dashboard)
      .state(chat_tracker);

  // default fallback route
  // Workaround for infinite digest loop error - see https://github.com/Narzerus/angular-permission/issues/65
  $urlRouterProvider.otherwise( function($injector) {
    var $state = $injector.get("$state");
    $state.go('root.dashboard');
  });

}]);
